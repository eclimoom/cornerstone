<!DOCTYPE HTML>
<html>
<head>

</head>
<body>
<div class="container">

    <h1>
        falseColorMapping/index.html
    </h1>

    This example shows you how to use the pre-defined colormaps or create a custom lookup table and use them to create a false color mapping

    <div class="row">
        <div class="col-xs-10">
            <div style="width:512px; padding-top: 5px;">
                <canvas id="colorbar" width="512px" height="20px"></canvas>
            </div>
            <!-- note we disable selection on the top most div -->
            <div style="width:512px;height:512px;position:relative;color: white;"
                 class="cornerstone-enabled-image"
                 oncontextmenu="return false"
                 unselectable='on'
                 onselectstart='return false;'
                 onmousedown='return false;'>
                <div id="dicomImage"
                     style="width:512px;height:512px;top:0px;left:0px; position:absolute">
                </div>
            </div>
        </div>
        <div class="col-xs-2">
            <label for="colormaps"> Colormap </label>
            <select id="colormaps" style="width:100%">
                <option value="">Select...</option>
            </select>
        </div>
    </div>
</div>
</body>

<!-- cornerstone depends on jQuery so it must be loaded first-->
<script src="../jquery.min.js"></script>

<!-- include the cornerstone library -->
<script src="../../dist/cornerstone.js"></script>

<!-- include special code for these examples which provides images -->
<script src="../exampleImageIdLoader.js"></script>

<script>

    // Populate colormap dropdown with all the default ones available
    // in cornerstone and also a "Custom" option
    function fillColormapsList() {
        var $dropdown = $('#colormaps');
        var colormapsList = cornerstone.colors.getColormapsList();

        var addOption = function(id, name, disabled) {
            var $option = $('<option></option>')
                .val(id)
                .text(name)

            if(disabled) {
                $option.prop('disabled', true);
            }

            $dropdown.append($option);
        }

        colormapsList.forEach(function(colormapItem) {
            addOption(colormapItem.id, colormapItem.name);
        });

        // Horizontal Line
        addOption('', '──────────', true);

        addOption('custom', 'Custom');
    }

    $(document).ready(function() {
        // image enable the dicomImage element
        var element = $('#dicomImage').get(0);
        cornerstone.enable(element);

        var imageId = 'example://1';

        // Load the example image and display it
        cornerstone.loadImage(imageId).then(function(image) {
            cornerstone.displayImage(element, image);
        //
            $('#dicomImage').mousedown(function (e) {
                var lastX = e.pageX;
                var lastY = e.pageY;

                var mouseButton = e.which;

                $(document).mousemove(function (e) {
                    var deltaX = e.pageX - lastX
                    var deltaY = e.pageY - lastY;
                    lastX = e.pageX;
                    lastY = e.pageY;

                    e.stopPropagation();
                    var viewport = cornerstone.getViewport(element);

                    if (mouseButton == 1) {
                        viewport.voi.windowWidth += (deltaX / viewport.scale);
                        viewport.voi.windowCenter += (deltaY / viewport.scale);
                        cornerstone.setViewport(element, viewport);
                        $('#bottomleft').text("WW/WL:" + Math.round(viewport.voi.windowWidth) + "/" + Math.round(viewport.voi.windowCenter));
                    }
                });

                $(document).mouseup(function (e) {
                    $(document).unbind('mousemove');
                    $(document).unbind('mouseup');
                });
            });
        });

        // Dropdown listener to get the new colormap
        // selected by the user and update the image
        function colormapChanged() {
            // var image = cornerstone.getEnabledElement(element).image;
            var colormap = cornerstone.colors.getColormap($('#colormaps').val());

            var viewport = cornerstone.getViewport(element);
            viewport.colormap = colormap;
            cornerstone.setViewport(element, viewport);
            // cornerstone.convertToFalseColorImage(element, colormap);
            cornerstone.updateImage(element, true);

        }
        $('#colormaps').change(function() {
            colormapChanged();
        });
        fillColormapsList();
    });

</script>
</html>
